<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCS vs MRU Simulation Results</title>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            padding: 20px;
        }
        h1, h2 {
            text-align: center;
            color: #2c3e50;
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        .chart-box {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 20px;
        }
        .grouped-chart {
            grid-column: 1 / -1;
        }
        .line-chart-small {
        max-width: 800px;
        margin: 20px auto;
        }
        .line-chart-small canvas {
            height: 260px !important;   /* adjust as needed */
        }
        @media (min-width: 900px) {
            .container {
                grid-template-columns: 1fr 1fr 1fr;
            }
        }
    </style>
</head>
<body>

    <h1>FaaS Scheduler Simulation Analysis</h1>

    <div class="container" id="charts-container"></div>

    <!-- SCRIPTS -->
    <script type="module">

        // ⭐ Number of experiments
        const experimentCount = 3;

        const lcsColor = 'rgba(54, 162, 235, 0.8)';
        const mruColor = 'rgba(255, 99, 132, 0.8)';
        const lcsBorder = 'rgba(54, 162, 235, 1)';
        const mruBorder = 'rgba(255, 99, 132, 1)';

        const container = document.getElementById("charts-container");

        async function loadJson(path) {
            return (await import(path, { with: { type: "json" } })).default;
        }

        async function loadExperiment(i) {
            const lcs = await loadJson(`./results/exp${i}_lru.json`);
            const mru = await loadJson(`./results/exp${i}_mru.json`);
            return { lcs, mru };
        }

        async function renderAllExperiments() {

            const allLcs = [];
            const allMru = [];

            for (let i = 1; i <= experimentCount; i++) {
                const { lcs, mru } = await loadExperiment(i);

                allLcs.push(lcs);
                allMru.push(mru);

                renderExperiment(i, lcs, mru);
            }

            // NEW — two line charts
            renderColdVsRequests(allLcs, allMru);
            renderWarmVsRequests(allLcs, allMru);
        }

        function renderExperiment(i, lcsData, mruData) {

            const csID  = `cs-${i}`;
            const wsID  = `ws-${i}`;
            const rqID  = `rq-${i}`;
            const funcID = `func-${i}`;

            const block = document.createElement("div");

            block.innerHTML = `
                <div style="grid-column: 1 / -1; margin-top:40px;">
                    <h2>Experiment ${i}</h2>
                </div>

                <!-- ⭐ Total Requests Summary -->
                <div class="chart-box" style="grid-column: 1 / -1; text-align:center;">
                    <h3>Total Requests = ${lcsData.total_requests_received}</h3>
                </div>

                <div class="chart-box">
                    <h2>Total Cold Starts</h2>
                    <canvas id="${csID}"></canvas>
                </div>

                <div class="chart-box">
                    <h2>Total Warm Starts</h2>
                    <canvas id="${wsID}"></canvas>
                </div>

                <div class="chart-box">
                    <h2>Total Requests Queued</h2>
                    <canvas id="${rqID}"></canvas>
                </div>

                <div class="chart-box grouped-chart">
                    <h2>Detailed Comparison by Function</h2>
                    <canvas id="${funcID}"></canvas>
                </div>
            `;

            container.appendChild(block);

            new Chart(document.getElementById(csID), {
                type: 'bar',
                data: {
                    labels: ['LCS', 'MRU'],
                    datasets: [{
                        label: 'Cold Starts',
                        data: [lcsData.total_cold_starts, mruData.total_cold_starts],
                        backgroundColor: [lcsColor, mruColor],
                        borderColor: [lcsBorder, mruBorder],
                        borderWidth: 1
                    }]
                }
            });

            new Chart(document.getElementById(wsID), {
                type: 'bar',
                data: {
                    labels: ['LCS', 'MRU'],
                    datasets: [{
                        label: 'Warm Starts',
                        data: [lcsData.total_warm_starts, mruData.total_warm_starts],
                        backgroundColor: [lcsColor, mruColor],
                        borderColor: [lcsBorder, mruBorder],
                        borderWidth: 1
                    }]
                }
            });

            new Chart(document.getElementById(rqID), {
                type: 'bar',
                data: {
                    labels: ['LCS', 'MRU'],
                    datasets: [{
                        label: 'Requests Queued',
                        data: [lcsData.total_requests_queued, mruData.total_requests_queued],
                        backgroundColor: [lcsColor, mruColor],
                        borderColor: [lcsBorder, mruBorder],
                        borderWidth: 1
                    }]
                }
            });

            const funcs = Object.keys(lcsData.functions);
            new Chart(document.getElementById(funcID), {
                type: 'bar',
                data: {
                    labels: funcs,
                    datasets: [
                        {
                            label: 'LCS Cold',
                            data: funcs.map(f => lcsData.functions[f].cold_starts),
                            backgroundColor: lcsColor,
                            borderColor: lcsBorder,
                            borderWidth: 1
                        },
                        {
                            label: 'MRU Cold',
                            data: funcs.map(f => mruData.functions[f].cold_starts),
                            backgroundColor: mruColor,
                            borderColor: mruBorder,
                            borderWidth: 1
                        }
                    ]
                }
            });
        }

        /* =============================================================
            NEW LINE CHART #1
            Cold Starts vs Total Requests
        ============================================================= */
        function renderColdVsRequests(allLcs, allMru) {
            const canvas = document.createElement("canvas");
            const box = document.createElement("div");
            box.classList.add("chart-box", "line-chart-small");

            box.style.marginTop = "50px";
            box.innerHTML = `<h2 style="text-align:center;">Cold Starts vs Total Requests</h2>`;
            box.appendChild(canvas);
            document.body.appendChild(box);

            new Chart(canvas, {
                type: "line",
                data: {
                    labels: allLcs.map(d => d.total_requests_received),
                    datasets: [
                        {
                            label: "LCS Cold Starts",
                            data: allLcs.map(d => d.total_cold_starts),
                            borderColor: lcsBorder,
                            backgroundColor: lcsColor,
                            tension: 0.3,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        },
                        {
                            label: "MRU Cold Starts",
                            data: allMru.map(d => d.total_cold_starts),
                            borderColor: mruBorder,
                            backgroundColor: mruColor,
                            tension: 0.3,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                }
            });
        }

        /* =============================================================
            NEW LINE CHART #2
            Warm Starts vs Total Requests
        ============================================================= */
        function renderWarmVsRequests(allLcs, allMru) {
            const canvas = document.createElement("canvas");
            const box = document.createElement("div");
            box.classList.add("chart-box", "line-chart-small");

            box.style.marginTop = "50px";
            box.innerHTML = `<h2 style="text-align:center;">Warm Starts vs Total Requests</h2>`;
            box.appendChild(canvas);
            document.body.appendChild(box);

            new Chart(canvas, {
                type: "line",
                data: {
                    labels: allLcs.map(d => d.total_requests_received),
                    datasets: [
                        {
                            label: "LCS Warm Starts",
                            data: allLcs.map(d => d.total_warm_starts),
                            borderColor: lcsBorder,
                            backgroundColor: lcsColor,
                            tension: 0.3,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        },
                        {
                            label: "MRU Warm Starts",
                            data: allMru.map(d => d.total_warm_starts),
                            borderColor: mruBorder,
                            backgroundColor: mruColor,
                            tension: 0.3,
                            pointRadius: 0,
                            pointHoverRadius: 0
                        }
                    ]
                }
            });
        }

        renderAllExperiments();

    </script>

</body>
</html>
